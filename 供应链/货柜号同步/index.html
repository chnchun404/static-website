<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>货柜号同步</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        primaryLight: '#E8F3FF',
                        primaryDark: '#0E42CC',
                        secondary: '#0E2B8A',
                        light: '#F9FBFF',
                        dark: '#1D2129',
                        gray: '#86909C',
                        grayLight: '#F0F2F5',
                        grayBorder: '#E5E6EB'
                    },
                    fontFamily: {
                        sans: ['Microsoft YaHei', 'PingFang SC', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 2px 12px 0 rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 6px 16px 0 rgba(0, 0, 0, 0.08)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .collapse-item {
                border-bottom: 1px solid theme('colors.grayBorder');
            }
            /* 折叠面板核心样式（优化点击区域和优先级） */
            .collapse-header {
                cursor: pointer;
                transition: all 0.2s ease;
                width: 100%; /* 确保点击区域全覆盖 */
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative; /* 确保子元素点击不穿透 */
            }
            /* 强制箭头区域也可点击 */
            .collapse-header > i {
                cursor: pointer;
                z-index: 1; /* 确保箭头在点击层级最上层 */
            }
            .collapse-content {
                max-height: 0;
                opacity: 0;
                transition: all 0.4s ease-in-out;
                overflow: hidden;
                padding-top: 0;
                padding-left: 0.5rem;
            }
            /* 激活状态下展开内容（提升选择器优先级） */
            .collapse-header.active + .collapse-content {
                max-height: 2000px;
                opacity: 1;
                padding-top: 1rem;
                padding-bottom: 0.5rem;
            }
            /* 折叠图标旋转动画（确保生效） */
            .collapse-header .fa-chevron-down {
                transition: transform 0.3s ease-in-out;
                display: inline-block;
                vertical-align: middle;
                font-size: 12px;
                width: 20px; /* 扩大箭头点击区域 */
                height: 20px;
                text-align: center;
                line-height: 20px;
            }
            .collapse-header.active .fa-chevron-down {
                transform: rotate(180deg);
            }
            .step-card {
                border-left: 3px solid theme('colors.primaryLight');
                padding-left: 1rem;
                margin-bottom: 1.5rem;
                position: relative;
            }
            .step-card::before {
                content: '';
                position: absolute;
                left: -3px;
                top: 0;
                height: 100%;
                width: 3px;
                background: linear-gradient(to bottom, theme('colors.primary'), transparent);
                opacity: 0.3;
            }
            .table-hover-row {
                transition: background-color 0.2s ease;
            }
        }
    </style>
</head>
<body class="bg-light text-dark font-sans min-h-screen">
    
    <!-- 页面头部 -->
    <header class="py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-primaryLight">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-[clamp(22px,4vw,32px)] font-bold text-secondary mb-3">
                货柜号同步
            </h1>
            <p class="text-gray text-base sm:text-lg max-w-3xl mx-auto">
                超时代数据获取 · 马帮ERP货柜号填入 · 海仓系统货柜号编辑 · 跨系统数据同步 · 流程回执单生成 | 替代人工跨系统操作，提升货柜号同步效率与准确性
            </p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6">
        <!-- 板块1：业务背景 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-bullseye text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">一、业务背景</h2>
            </div>
            <!-- 实施目的 -->
            <div class="pl-12 text-base leading-relaxed text-dark/85 mb-6">
                <h3 class="font-medium text-dark mb-2">1.1 实施目的</h3>
                <p>供应链部门需处理泰国站点多仓货柜号（总运单）跨系统同步业务，泰国3个仓库编码（2116/1096/9966）分别对应海仓、Tik Tok仓、Shopee仓，需从超时代系统获取运单号对应的总运单信息，完成马帮ERP货柜号填入、海仓系统货柜号编辑等操作。</p>
                <p class="mt-2">人工跨系统查询、填入、编辑货柜号操作繁琐且易出错，通过<b class="text-primary">全流程自动化设计</b>，实现从超时代数据获取到马帮/海仓货柜号录入的端到端自动化，解决人工操作痛点，提升货柜号同步处理效率与数据准确性，同时生成流程回执单实现操作可追溯。</p>
            </div>
            <!-- 基本信息 -->
            <div class="pl-12 overflow-x-auto">
                <h3 class="font-medium text-dark mb-2">1.2 基础信息</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">流程名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">所属部门</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">操作频率</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">核心价值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">海仓_马帮ERP_货柜号同步至ERP系统</td>
                            <td class="p-3 border border-grayBorder">供应链</td>
                            <td class="p-3 border border-grayBorder">每日执行（基于当日货柜号Excel文件数据）</td>
                            <td class="p-3 border border-grayBorder">自动化跨系统填录货柜号，减少人工重复操作，实现操作全流程可追溯</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- 仓库编码映射 -->
            <div class="pl-12 overflow-x-auto mt-6">
                <h3 class="font-medium text-dark mb-2">1.3 泰国仓库编码映射关系</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">唛头编码</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">对应泰国仓库</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">超时代登录账号</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">对应海仓仓库</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">2116</td>
                            <td class="p-3 border border-grayBorder">泰国海仓</td>
                            <td class="p-3 border border-grayBorder">CSD2116</td>
                            <td class="p-3 border border-grayBorder">(TH243)海仓泰国6仓</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">1096</td>
                            <td class="p-3 border border-grayBorder">泰国Tik Tok仓</td>
                            <td class="p-3 border border-grayBorder">CSD1096</td>
                            <td class="p-3 border border-grayBorder">(TH2)海仓泰国2仓</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">9966</td>
                            <td class="p-3 border border-grayBorder">泰国Shopee仓</td>
                            <td class="p-3 border border-grayBorder">CSD9966</td>
                            <td class="p-3 border border-grayBorder">(TH228)海仓泰国5仓</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 板块2：功能模块 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-desktop text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">二、功能模块</h2>
            </div>
            <!-- 应用系统 -->
            <div class="pl-12 mb-6">
                <h3 class="font-medium text-dark mb-2">2.1 涉及应用系统</h3>
                <p class="text-sm text-dark/80 mb-3">系统类型：浏览器网页/客户端 | 验证码类型：无</p>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="bg-primaryLight text-left">
                                <th class="p-3 border border-grayBorder font-medium text-primary">系统名称</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">类型</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">需账号密码</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">系统地址</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">超时代系统（CSD）</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes（仓配专用）</td>
                                <td class="p-3 border border-grayBorder">https://csd.ricecs.cn/client/#/user/login</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">马帮ERP</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">https://www.mabangerp.com</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">海仓系统（OMS）</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">https://oms.seacang.com/</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">WPS（Excel）</td>
                                <td class="p-3 border border-grayBorder">客户端</td>
                                <td class="p-3 border border-grayBorder">无</td>
                                <td class="p-3 border border-grayBorder">本地/共享文件夹</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 模块概览 -->
            <div class="pl-12 overflow-x-auto">
                <h3 class="font-medium text-dark mb-2">2.2 核心模块概览</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">模块名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">涉及系统</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">核心功能</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">前置环境清理</td>
                            <td class="p-3 border border-grayBorder">Windows系统</td>
                            <td class="p-3 border border-grayBorder">终止WPS进程、关闭所有Chrome浏览器，避免资源占用</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">输入文件数据读取与解析</td>
                            <td class="p-3 border border-grayBorder">Excel</td>
                            <td class="p-3 border border-grayBorder">读取货柜号Excel文件，按唛头分组运单号，生成唛头-运单号映射关系</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">多系统统一登录</td>
                            <td class="p-3 border border-grayBorder">马帮ERP+海仓系统</td>
                            <td class="p-3 border border-grayBorder">完成马帮、海仓系统基础登录，为后续操作做准备</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">超时代多账号登录与数据获取</td>
                            <td class="p-3 border border-grayBorder">超时代系统</td>
                            <td class="p-3 border border-grayBorder">按唛头匹配专用账号登录，查询获取运单号-总运单（货柜号）映射数据</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">马帮ERP货柜号填入</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">在仓库调拨发货模块，为对应运单号备注栏填入货柜号（总运单）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">海仓系统货柜号编辑</td>
                            <td class="p-3 border border-grayBorder">海仓系统</td>
                            <td class="p-3 border border-grayBorder">在入库订单草稿模块，编辑对应运单号备注栏，追加货柜号并确认提交</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">流程回执单生成</td>
                            <td class="p-3 border border-grayBorder">Excel</td>
                            <td class="p-3 border border-grayBorder">生成含操作状态的Excel回执单，记录每笔运单号处理结果与失败原因</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 板块3：异常处理机制 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exclamation-triangle text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">三、异常处理机制</h2>
            </div>
            <div class="pl-12 space-y-3" id="exception-section">
                <!-- 全部展开/收起按钮 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg hover:bg-primaryLight/80" id="allCollapseBtn">
                    <span class="font-medium text-primary">展开/收起所有异常处理规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary"></i>
                </div>

                <!-- 步骤1：输入文件处理 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤1：输入文件读取与解析</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>读取Excel文件无有效数据（唛头-运单号映射为空），直接抛出异常终止流程</li>
                                <li>文件读取失败触发异常捕获，记录完整错误堆栈信息</li>
                                <li>运单号数据强制转换为字符串类型，避免数字格式异常导致的匹配失败</li>
                                <li>指定路径无Excel文件时，触发文件不存在异常，终止流程并记录原因</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤2：超时代系统操作 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤2：超时代系统登录与数据获取</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>打开超时代网址异常，无法显示登录按钮则抛出登录异常</li>
                                <li>登录后30秒内未显示首页运单管理模块，判定为登录失败并抛出异常</li>
                                <li>查询后未获取到运单号-总运单数据，记录错误日志并跳过该唛头后续所有操作</li>
                                <li>页面加载中状态持续监控，最多等待30秒，确保数据加载完成再操作</li>
                                <li>多页数据查询时，下一页点击后加载超时，终止该批次数据获取并记录</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤3：马帮ERP货柜号填入 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤3：马帮ERP货柜号填入操作</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>超时代无对应总运单的运单号，标记马帮、海仓操作均失败，记录原因</li>
                                <li>运单号在马帮已填入货柜号，直接标记成功并跳过重复操作</li>
                                <li>页面加载中状态持续监控，最多等待300秒，超时则判定加载失败</li>
                                <li>任意操作环节抛出异常，记录错误堆栈并对马帮页面进行重置</li>
                                <li>页面重置逻辑：重新加载页面、关闭授权弹窗、重新定位操作入口，恢复操作环境</li>
                                <li>填入货柜号后二次校验备注栏，未成功则重新填入并保存，仍失败则标记异常</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤4：海仓系统货柜号编辑 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤4：海仓系统货柜号编辑操作</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>检测到海仓登录失效，自动触发重新登录逻辑，无需人工干预</li>
                                <li>运单号在海仓草稿中无查询结果，标记失败并记录具体原因</li>
                                <li>货柜号已存在于海仓备注中，直接标记成功并跳过重复操作</li>
                                <li>搜索/保存操作页面加载超时（最长60秒），抛出异常并记录</li>
                                <li>任意操作环节抛出异常，执行海仓页面重置逻辑并继续处理下一条数据</li>
                                <li>页面重置逻辑：重新加载页面、处理登录弹窗、重新定位入库订单操作入口</li>
                                <li>已确认提交的运单数据，标记原因并跳过后续操作，避免重复提交</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤5：跨系统通用操作 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤5：跨系统通用操作异常</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>元素点击操作最多重试指定次数（全局配置），超时未找到元素则抛出异常并记录</li>
                                <li>网页创建/加载超时（最长800秒），判定为系统访问异常</li>
                                <li>单个唛头/运单号操作失败，记录错误信息并继续处理下一条，不终止整体流程</li>
                                <li>所有异常均记录完整的堆栈信息，方便问题定位与排查</li>
                                <li>系统弹窗（马帮店铺授权提醒、海仓待支付账单）自动识别并关闭，无人工干预</li>
                                <li>多系统页面切换时，先激活目标窗口再执行操作，避免元素定位失败</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块4：数据传输规范 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exchange text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">四、数据传输规范</h2>
            </div>
            <div class="pl-12 space-y-3" id="data-section">
                <!-- 全部展开/收起按钮 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg hover:bg-primaryLight/80" id="allCollapseBtn2">
                    <span class="font-medium text-primary">展开/收起所有数据传输规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary"></i>
                </div>

                <!-- 规则1：输入文件解析规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则1：输入Excel文件解析规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>文件格式：仅支持.xlsx格式，数据字段为「唛头」「运单号」</li>
                                <li>数据类型：所有字段强制转换为字符串类型，避免数字格式异常</li>
                                <li>分组规则：按「唛头」字段分组聚合「运单号」，生成唛头-运单号列表映射关系</li>
                                <li>数据校验：分组后无有效数据则直接抛出异常，终止流程</li>
                                <li>文件路径：从全局变量获取输入文件路径，固定为指定业务文件夹，不支持自定义</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则2：超时代数据获取规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则2：超时代系统数据获取规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>账号匹配：唛头编码与超时代登录账号一一对应（2116→CSD2116等），仓配专用</li>
                                <li>查询条件：以唛头对应的运单号列表作为查询关键字，批量搜索</li>
                                <li>数据返回：以字典格式返回运单号-总运单映射关系（key：运单号，value：总运单）</li>
                                <li>数据校验：未获取到数据则记录错误日志，跳过该唛头后续所有操作</li>
                                <li>分页处理：查询结果按100条/页分页，自动遍历所有分页获取完整数据</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则3：马帮/海仓货柜号填录规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则3：马帮/海仓货柜号填录规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>填录位置：均在对应运单号的「备注」栏位，采用追加模式（保留原有备注）</li>
                                <li>填录格式：总运单（货柜号）前加空格分隔，避免与原有内容粘连</li>
                                <li>前置校验：填录前先检查备注栏是否已存在该货柜号，存在则跳过</li>
                                <li>后置校验：填录保存后二次校验备注栏，确保货柜号成功写入</li>
                                <li>仓库匹配：海仓操作前自动按唛头匹配对应仓库，无需人工选择</li>
                                <li>执行顺序：海仓货柜号编辑操作，仅在马帮操作成功后执行</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则4：回执单生成规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则4：流程回执单生成规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>核心字段：运单号、唛头、总运单、(马帮)是否填入成功、(海仓)是否填入成功、失败原因</li>
                                <li>状态值：成功/否，失败原因需填充具体异常信息（如“超时代无对应数据”“海仓查询无结果”）</li>
                                <li>特殊标记：重复操作、已存在货柜号等情况，在失败原因栏标注具体说明</li>
                                <li>命名规则：{毫秒级时间戳}_回执单.xlsx，避免文件重名覆盖</li>
                                <li>存储路径：从全局变量获取输出文件路径，与输入文件文件夹分离，便于管理</li>
                                <li>全局记录：回执单文件路径写入全局变量（Output_RETURN_RECEIPT），方便后续业务调用</li>
                                <li>数据类型：所有字段均为字符串类型，确保数据显示一致性</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则5：全局变量使用规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header py-2 px-0 group">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则5：全局变量使用与数据传输规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>基础配置：登录信息、输入/输出文件夹、重试次数等配置项，均从全局变量读取</li>
                                <li>动态参数：页面操作索引、仓库名称等动态参数，写入全局变量实现模块间传输</li>
                                <li>结果存储：回执单文件路径写入全局变量（Output_RETURN_RECEIPT），提供外部调用</li>
                                <li>命名规范：全局变量采用大驼峰+下划线命名，语义化标记用途（如dict_login_info、input_file_folder）</li>
                                <li>数据映射：仓库编码、登录信息等固定映射关系，通过全局字典变量统一管理，便于维护</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块5：系统依赖 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-cogs text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">五、系统依赖</h2>
            </div>
            <div class="pl-12 space-y-4">
                <div class="bg-grayLight p-4 rounded-lg">
                    <h3 class="font-medium text-dark mb-2">5.1 基础运行环境</h3>
                    <ul class="list-disc pl-6 space-y-1 text-sm">
                        <li>操作系统：Windows（依赖系统进程管理、本地/共享文件操作）</li>
                        <li>编程语言：Python 3.x</li>
                        <li>浏览器：Chrome（自动化操作指定浏览器，需开启最大化模式）</li>
                    </ul>
                </div>
                <div class="bg-grayLight p-4 rounded-lg">
                    <h3 class="font-medium text-dark mb-2">5.2 核心Python库/框架</h3>
                    <ul class="list-disc pl-6 space-y-1 text-sm">
                        <li>自动化核心：xbot（网页自动化、元素定位/操作、进程管理）</li>
                        <li>视觉校验：xbot_visual（图像识别，检测页面加载中状态）</li>
                        <li>数据处理：pandas（Excel文件读取/解析、回执单生成）</li>
                        <li>系统操作：os（文件/路径管理、系统命令执行）、math（分页计算）</li>
                        <li>时间控制：time（操作延时、超时控制、时间戳生成）</li>
                        <li>日志记录：xbot.app.logging（全流程操作日志、错误日志记录）</li>
                        <li>异常追踪：traceback（记录完整异常堆栈，方便问题排查）</li>
                    </ul>
                </div>
                <div class="bg-grayLight p-4 rounded-lg">
                    <h3 class="font-medium text-dark mb-2">5.3 自定义/扩展模块</h3>
                    <ul class="list-disc pl-6 space-y-1 text-sm">
                        <li>本地工具模块：tools.py（提供时间获取等通用工具函数）</li>
                        <li>登录扩展模块：xbot_extensions（马帮/海仓/超时代登录、重新登录逻辑）</li>
                        <li>业务包模块：package（获取元素、访问全局变量、获取资源文件等）</li>
                        <li>通用工具类：CommonUtil（提供元素点击等通用自动化操作方法，禁止实例化）</li>
                    </ul>
                </div>
                <div class="bg-grayLight p-4 rounded-lg">
                    <h3 class="font-medium text-dark mb-2">5.4 第三方业务系统</h3>
                    <ul class="list-disc pl-6 space-y-1 text-sm">
                        <li>超时代系统（CSD）：https://csd.ricecs.cn（货柜号/总运单数据唯一来源）</li>
                        <li>马帮ERP：https://www.mabangerp.com（货柜号填入，仓库调拨发货管理）</li>
                        <li>海仓OMS系统：https://oms.seacang.com/（货柜号编辑，入库订单草稿管理）</li>
                    </ul>
                </div>
                <div class="bg-grayLight p-4 rounded-lg">
                    <h3 class="font-medium text-dark mb-2">5.5 外部资源依赖</h3>
                    <ul class="list-disc pl-6 space-y-1 text-sm">
                        <li>Excel输入文件：供应链专员每日更新的货柜号-运单号映射文件（指定文件夹）</li>
                        <li>元素定位资源：package包中的元素选择器（映射系统页面元素，用于自动化定位）</li>
                        <li>全局配置：package.variables中的全局变量（登录信息、文件路径、重试次数等）</li>
                        <li>图像资源：加载中状态校验所需的模板图像（用于视觉识别）</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- 折叠面板交互逻辑（彻底修复版） -->
    <script>
        // 等待页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 通用折叠切换函数
            const toggleCollapse = (header) => {
                header.classList.toggle('active');
                // 同步父级全部展开按钮状态
                updateAllCollapseStatus(header.closest('#exception-section, #data-section'));
            };

            // 更新全部展开按钮状态
            const updateAllCollapseStatus = (container) => {
                if (!container) return;
                const allBtn = container.querySelector('#allCollapseBtn, #allCollapseBtn2');
                if (!allBtn) return;
                
                const allItems = container.querySelectorAll('.collapse-item .collapse-header');
                const allActive = Array.from(allItems).every(item => item.classList.contains('active'));
                const someActive = Array.from(allItems).some(item => item.classList.contains('active'));
                
                if (allActive) {
                    allBtn.classList.add('active');
                } else if (!someActive) {
                    allBtn.classList.remove('active');
                }
            };

            // 1. 单个折叠项点击事件（包含箭头、文字等所有子元素）
            const collapseItems = document.querySelectorAll('.collapse-item .collapse-header');
            collapseItems.forEach(header => {
                // 给整个collapse-header绑定点击事件，包含所有子元素
                header.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleCollapse(this);
                });
                // 额外给箭头单独绑定，确保兼容性
                const arrow = header.querySelector('.fa-chevron-down');
                if (arrow) {
                    arrow.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleCollapse(header);
                    });
                }
            });

            // 2. 异常处理板块的“全部展开/收起”按钮
            const allCollapseBtn = document.getElementById('allCollapseBtn');
            if (allCollapseBtn) {
                allCollapseBtn.addEventListener('click', function() {
                    const isActive = this.classList.toggle('active');
                    const targetItems = document.querySelectorAll('#exception-section .collapse-item .collapse-header');
                    targetItems.forEach(item => {
                        if (isActive) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                });
                // 箭头单独绑定
                const arrow = allCollapseBtn.querySelector('.fa-chevron-down');
                if (arrow) {
                    arrow.addEventListener('click', function(e) {
                        e.stopPropagation();
                        allCollapseBtn.click();
                    });
                }
            }

            // 3. 数据传输规范板块的“全部展开/收起”按钮（补全之前缺失的逻辑）
            const allCollapseBtn2 = document.getElementById('allCollapseBtn2');
            if (allCollapseBtn2) {
                allCollapseBtn2.addEventListener('click', function() {
                    const isActive = this.classList.toggle('active');
                    const targetItems = document.querySelectorAll('#data-section .collapse-item .collapse-header');
                    targetItems.forEach(item => {
                        if (isActive) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                });
                // 箭头单独绑定
                const arrow = allCollapseBtn2.querySelector('.fa-chevron-down');
                if (arrow) {
                    arrow.addEventListener('click', function(e) {
                        e.stopPropagation();
                        allCollapseBtn2.click();
                    });
                }
            }
        });
    </script>
</body>
</html>
