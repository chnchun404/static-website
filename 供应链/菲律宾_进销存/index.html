<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>菲律宾进销存-汇总表统计流程</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        primaryLight: '#E8F3FF',
                        primaryDark: '#0E42CC',
                        secondary: '#0E2B8A',
                        light: '#F9FBFF',
                        dark: '#1D2129',
                        gray: '#86909C',
                        grayLight: '#F0F2F5',
                        grayBorder: '#E5E6EB'
                    },
                    fontFamily: {
                        sans: ['Microsoft YaHei', 'PingFang SC', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 2px 12px 0 rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 6px 16px 0 rgba(0, 0, 0, 0.08)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .collapse-item {
                border-bottom: 1px solid theme('colors.grayBorder');
            }
            /* 通用折叠面板展开样式（全部/单个联动） */
            .collapse-header.active + .collapse-content {
                max-height: 2000px;
                opacity: 1;
                padding-top: 1rem;
            }
            .collapse-content {
                max-height: 0;
                opacity: 0;
                transition: all 0.4s ease-in-out;
                overflow: hidden;
                padding-top: 0;
            }
            .step-card {
                border-left: 3px solid theme('colors.primaryLight');
                padding-left: 1rem;
                margin-bottom: 1.5rem;
                position: relative;
            }
            .step-card::before {
                content: '';
                position: absolute;
                left: -3px;
                top: 0;
                height: 100%;
                width: 3px;
                background: linear-gradient(to bottom, theme('colors.primary'), transparent);
                opacity: 0.3;
            }
            .table-hover-row {
                transition: background-color 0.2s ease;
            }
            /* 折叠图标旋转动画（交互反馈） */
            .collapse-header.active i.fa-chevron-down {
                transform: rotate(180deg);
            }
            .collapse-header i.fa-chevron-down {
                transition: transform 0.3s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-light text-dark font-sans min-h-screen">
    <!-- 页面头部 -->
    <header class="py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-primaryLight">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-[clamp(22px,4vw,32px)] font-bold text-secondary mb-3">
                菲律宾进销存-汇总表统计流程
            </h1>
            <p class="text-gray text-base sm:text-lg max-w-3xl mx-auto">
                供应链数据统计自动化方案 | 多平台导出 · 多仓数据清洗 · 汇总分析 · 备货触发
            </p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6">
        <!-- 板块1：业务背景 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-bullseye text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">一、业务背景</h2>
            </div>
            <!-- 实施目的 -->
            <div class="pl-12 text-base leading-relaxed text-dark/85 mb-6">
                <h3 class="font-medium text-dark mb-2">1.1 实施目的</h3>
                <p>供应链部门需对菲律宾站点<b>2仓、3仓、海外仓、二仓（海仓国际）</b>的库存、销量、采购在途、调拨在途、平均发货时间等核心数据进行每日汇总统计，同时自动识别触发备货的SKU并同步至各仓汇总表。</p>
                <p class="mt-2">人工完成多平台（马帮ERP、海仓国际）数据导出、跨仓数据清洗、公式计算、备货SKU筛选等工作，存在<b>效率低、易出错、跨仓数据不一致</b>等痛点，通过自动化流程实现端到端的数据分析，提升数据准确性与工作效率。</p>
            </div>
            <!-- 基本信息 -->
            <div class="pl-12 overflow-x-auto">
                <h3 class="font-medium text-dark mb-2">1.2 基础信息</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">流程名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">所属部门</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">操作频率</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">单次耗时</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">菲律宾进销存2.0-汇总表统计</td>
                            <td class="p-3 border border-grayBorder">供应链</td>
                            <td class="p-3 border border-grayBorder">每日执行（定时/手动触发）</td>
                            <td class="p-3 border border-grayBorder">自动化：8~15分钟</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 板块2：功能模块 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-desktop text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">二、功能模块</h2>
            </div>
            <!-- 应用系统 -->
            <div class="pl-12 mb-6">
                <h3 class="font-medium text-dark mb-2">2.1 涉及应用系统</h3>
                <p class="text-sm text-dark/80 mb-3">系统类型：浏览器网页/客户端 | 验证码类型：无 | 多账号独立校验</p>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="bg-primaryLight text-left">
                                <th class="p-3 border border-grayBorder font-medium text-primary">系统名称</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">类型</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">需账号密码</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">核心用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">WPS（Excel）</td>
                                <td class="p-3 border border-grayBorder">客户端</td>
                                <td class="p-3 border border-grayBorder">无</td>
                                <td class="p-3 border border-grayBorder">数据清洗、公式计算、汇总存储</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">马帮ERP</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">多仓库存/销量/在途数据导出</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">海仓国际</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">二仓实时库存数据导出</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 模块概览 -->
            <div class="pl-12 overflow-x-auto mb-6">
                <h3 class="font-medium text-dark mb-2">2.2 核心模块概览</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">模块名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">涉及平台</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">输出文件类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">菲律宾2仓/3仓库存导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">XLSX</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">库存SKU全量导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">XLSX</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">采购在途数据导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">XLSX</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">调拨在途（2/3仓）导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">XLS（兼容转换）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">平均发货时间导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">XLSX（多页合并）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">马帮销量（2/3仓/合计）导出</td>
                            <td class="p-3 border border-grayBorder">马帮ERP</td>
                            <td class="p-3 border border-grayBorder">CSV</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">海仓国际二仓库存导出</td>
                            <td class="p-3 border border-grayBorder">海仓国际</td>
                            <td class="p-3 border border-grayBorder">XLSX</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">多仓数据清洗与汇总</td>
                            <td class="p-3 border border-grayBorder">WPS Excel</td>
                            <td class="p-3 border border-grayBorder">XLSX（汇总模板）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">备货SKU筛选与同步</td>
                            <td class="p-3 border border-grayBorder">WPS Excel</td>
                            <td class="p-3 border border-grayBorder">XLSX（2/3仓汇总表）</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- 核心能力 -->
            <div class="pl-12">
                <h3 class="font-medium text-dark mb-2">2.3 核心自动化能力</h3>
                <ul class="list-disc pl-6 text-sm space-y-2 text-dark/85">
                    <li>多平台账号自动校验与重登，支持用户匹配验证，避免错登账号</li>
                    <li>跨仓数据自动分类存储，按日期创建专属文件夹，文件命名含UUID防重复</li>
                    <li>异格式文件兼容处理（XLS转XLSX、CSV解析、多页Excel合并）</li>
                    <li>自动识别新增SKU并补充至汇总表，公式批量向下填充，保持格式统一</li>
                    <li>按“是否触发备货”自动筛选SKU，同步至2仓/3仓汇总表并保留计算公式</li>
                    <li>2/3仓日销数据自动合并，计算7/14/30天平均销量，支撑备货决策</li>
                </ul>
            </div>
        </section>

        <!-- 板块3：异常处理机制 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exclamation-triangle text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">三、异常处理机制</h2>
            </div>
            <div class="pl-12 space-y-3">
                <!-- 全部展开/收起按钮 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg cursor-pointer transition-all duration-300 hover:bg-primaryLight/80" id="allCollapseBtn">
                    <span class="font-medium text-primary">展开/收起所有异常处理规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary transition-transform duration-300"></i>
                </div>

                <!-- 步骤1：多平台登录异常 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤1：马帮ERP/海仓国际登录</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>谷歌浏览器打开平台网址，加载超时（300s）自动重试指定次数（glv['retry_times']）</li>
                                <li>校验当前登录用户与配置用户是否一致，不一致则自动退出并重新登录</li>
                                <li>登录按钮点击后300s内未显示登录成功，则判定登录失败并抛出异常</li>
                                <li>海仓国际登录后自动关闭待支付账单弹窗、登录失效提示框，避免弹窗阻塞操作</li>
                                <li>页面加载中状态持续监控，图像识别“加载中”图标超过300s则判定加载失败</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤2：多仓库存数据导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤2：菲律宾2/3仓库存数据导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>导出前自动创建目标文件夹，文件已存在则删除后重新导出，避免文件覆盖</li>
                                <li>导出操作失败自动重试指定次数，每次失败记录详细日志（traceback）</li>
                                <li>“另存为”弹窗超时（800s）未出现则强制关闭并重试导出</li>
                                <li>导出完成后校验文件路径是否存在，不存在则抛出FileDownLoadError异常</li>
                                <li>仓库选择框新旧版本兼容处理，自动适配页面元素变更</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤3：库存SKU/采购在途导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤3：库存SKU/采购在途数据导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>库存SKU导出时自动取消“合并共有项”复选框，勾选“新版导出”复选框，保证数据格式正确</li>
                                <li>搜索框输入“PH”筛选菲律宾SKU，搜索结果加载超时则重新搜索</li>
                                <li>采购在途导出模板自动选择“采购在途”，模板加载失败则刷新页面重试</li>
                                <li>导出后自动校验文件完整性，空文件则重新导出</li>
                                <li>多页导出时逐页校验，单页失败则整批重新导出</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤4：调拨在途数据导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤4：调拨在途（2/3仓）数据导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>调拨在途导出文件为XLS格式，自动调用win32com转换为Excel 97-2003兼容格式，解决xlrd无法读取问题</li>
                                <li>自动筛选“待签收”状态调拨单，目标仓库选择错误则重新筛选</li>
                                <li>导出模板自动选择“PH分仓调拨”，合并共有项复选框自动取消勾选</li>
                                <li>导出后校验数据件数，无数据则记录警告日志并跳过</li>
                                <li>WPS/Excel进程残留强制清理，执行taskkill /F /IM et.exe释放资源</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤5：销量数据导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤5：马帮销量（2/3仓/合计）导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>自动校验数据更新状态，5分钟内未获取到前1/2天数据则判定“数据未更新”并抛出异常</li>
                                <li>时间范围自动设置为“近1个月”，开始/结束时间输入框自动填充，避免手动配置错误</li>
                                <li>“另存为”对话框300s未出现则抛出异常，出现后自动粘贴文件路径并保存</li>
                                <li>导出文件为CSV格式，自动指定UTF-8编码，避免中文乱码</li>
                                <li>仓库选择框输入“菲律宾2/3仓”自动匹配，无匹配结果则重试</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤6：海仓国际二仓导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤6：海仓国际二仓库存导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>库存数据导出后自动刷新，10s后重新筛选仓库，保证数据实时性</li>
                                <li>导出任务完成时间监控，120s内未显示完成时间则重新导出</li>
                                <li>导出格式自动选择“中文+Excel+销售数据+在途数量”，避免漏选字段</li>
                                <li>导出失败后自动重置筛选条件，重新搜索仓库并导出</li>
                                <li>文件下载后5s校验文件是否存在，不存在则重试导出</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤7：数据清洗与汇总 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤7：多仓数据清洗与汇总</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>XLS格式文件自动调用WPS转换为Excel 97-2003兼容格式，解决xlrd读取失败问题</li>
                                <li>数据写入前清空目标工作表旧数据（保留表头），避免新旧数据混杂</li>
                                <li>数值列（如库存、销量）自动转换为int/float，转换失败则保留原始值，避免公式计算错误</li>
                                <li>新增SKU自动补充至汇总表“总表”，并批量向下填充公式，保持表结构统一</li>
                                <li>公式计算后自动调用WPS重新计算公式，解决openpyxl公式计算不生效问题</li>
                                <li>空值/异常值自动填充，IFERROR包裹公式，避免#N/A、#VALUE!等异常显示</li>
                                <li>备货SKU同步时，自动匹配“库存SKU”列位置，避免列位置变动导致同步失败</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块4：数据传输规范 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exchange text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">四、数据传输规范</h2>
            </div>
            <div class="pl-12 space-y-3">
                <!-- 全部展开/收起按钮 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg cursor-pointer transition-all duration-300 hover:bg-primaryLight/80" id="allCollapseBtn2">
                    <span class="font-medium text-primary">展开/收起所有数据传输规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary transition-transform duration-300"></i>
                </div>

                <!-- 规则1：2/3仓库存数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则1：菲律宾2/3仓库存数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>读取马帮ERP导出的XLSX文件，空值填充为空字符串，避免NaN显示</li>
                                <li>清空汇总表“菲律宾2仓/3仓”工作表旧数据（保留表头），逐行写入新数据</li>
                                <li>拆分O列销量数据（格式：数值/数值/数值），分别写入AF(32)、AG(33)、AH(34)列，转换为数值类型</li>
                                <li>数据写入完成后保存文件，调用WPS重新计算公式，确保实时性</li>
                                <li>对P~AB列数值进行格式统一，设置为“0”格式，避免科学计数法显示</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则2：库存SKU数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则2：库存SKU数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>读取库存SKU导出文件A~U列数据，写入汇总表“库存sku导出”工作表</li>
                                <li>F~Q列（数值列）自动转换为int/float类型，非数值则保留原始值</li>
                                <li>W列添加VLOOKUP公式：=VLOOKUP(A{行号},总表!A:A,1,0)，反查总表是否存在该SKU</li>
                                <li>调用WPS重新计算公式，筛选出#N/A的新增SKU，去重后补充至汇总表“总表”A列</li>
                                <li>新增SKU行自动批量向下填充“总表”原有公式，保持表结构和计算逻辑统一</li>
                                <li>W1单元格标注“检查是否新增”并填充黄色背景，突出提示</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则3：采购/调拨在途数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则3：采购/调拨在途数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>采购在途：读取A~J列数据，H列（数量）转换为数值类型，写入汇总表“采购在途”工作表</li>
                                <li>调拨在途：XLS文件先转换为Excel兼容格式，再读取数据，避免xlrd读取失败</li>
                                <li>调拨在途（2/3仓）分别写入“调拨在途-2仓/3仓”工作表，清空原有A~M列数据</li>
                                <li>L列添加预计到货时间公式：=F{行号}+25-TODAY()，M列添加LOOKUP公式匹配到货时效</li>
                                <li>J列（调拨数量）转换为数值类型，非数值则保留原始值</li>
                                <li>采购/调拨在途工作表均保留原始列名，不修改数据结构，保证溯源性</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则4：销量数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则4：马帮销量数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>读取CSV格式销量数据（UTF-8编码），空值填充为空字符串，避免解析错误</li>
                                <li>2仓/3仓销量分别写入“马帮-销量-2仓/3仓”工作表，合计销量写入“马帮-销量-两仓合计”工作表</li>
                                <li>两仓合计工作表新增AO列（修正后毛利率），添加公式：=AN{行号}+AL{行号}</li>
                                <li>销量数据均保留原始列名和数据结构，仅补充必要计算列，保证数据完整性</li>
                                <li>2/3仓日销数据自动合并，计算7/14/30天平均销量，分别写入对应列并设置“0.00”数值格式</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则5：海仓国际二仓数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则5：海仓国际二仓数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>调用WPS打开海仓国际导出文件，复制UsedRange数据，粘贴至汇总表“二仓”工作表，保留原始格式</li>
                                <li>清空“二仓”工作表原有数据，避免新旧数据混杂</li>
                                <li>E~O列（数值列）自动转换为int/float类型，非数值则保留原始值</li>
                                <li>新增“库存量”列，添加公式：=可用数量+待上架数量，自动计算实际库存</li>
                                <li>数据粘贴完成后清除剪贴板，释放系统资源，避免进程残留</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则6：平均发货时间清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则6：平均发货时间数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>合并多页导出的平均发货时间文件，逐行读取数据并去重</li>
                                <li>删除汇总表原有“发货平均时间”工作表，重新创建并写入固定列名</li>
                                <li>I~L列添加时间差公式（下单-付款、付款-入库等），使用DATEDIF函数计算天数，IFERROR包裹避免异常</li>
                                <li>M列添加平均天数公式：=AVERAGEIF(A:A,A{行号},L:L)，设置“0.00”数值格式，保留两位小数</li>
                                <li>所有公式均做空值判断，避免因源数据空值导致计算错误</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则7：备货SKU同步规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则7：备货SKU筛选与同步</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary transition-transform duration-300"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>从汇总表“总表”筛选“是否触发备货”为“是”的SKU，去重后生成备货SKU列表</li>
                                <li>按列名匹配“库存SKU”列位置，避免列位置变动导致同步失败</li>
                                <li>清空“2仓汇总/3仓汇总”工作表第3行及以下的SKU旧数据，保留第3行公式</li>
                                <li>备货SKU从第3行开始写入，逐行复制第3行公式并替换行号，保证每一行计算逻辑一致</li>
                                <li>无备货SKU时直接跳过，不修改汇总表原有数据，记录INFO日志</li>
                                <li>同步完成后调用WPS重新计算公式，确保备货SKU相关数据实时更新</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块5：系统依赖 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-cogs text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">五、系统依赖</h2>
            </div>
            <div class="pl-12 space-y-4">
                <!-- 环境依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.1 运行环境依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>操作系统：Windows 10/11 64位（需支持win32com、taskkill命令）</li>
                        <li>浏览器：Google Chrome 90.0+（需开启无痕模式、最大化启动）</li>
                        <li>办公软件：WPS Office 2021+（Excel组件，需支持Ket.Application接口）</li>
                        <li>运行时：Python 3.8+（需安装指定第三方库，见下方）</li>
                        <li>自动化框架：xbot/xbot_visual（影刀RPA框架，提供网页/桌面自动化能力）</li>
                    </ul>
                </div>
                <!-- Python库依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.2 Python第三方库依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>数据处理：pandas>=1.5.0、xlrd>=1.2.0、openpyxl>=3.0.10</li>
                        <li>Excel操作：win32com>=0.1.0、pywin32>=306</li>
                        <li>文件操作：shutil、os（内置）、uuid（内置）</li>
                        <li>时间处理：datetime>=4.3（内置）、time（内置）</li>
                        <li>截图与图片处理：pyautogui>=0.9.54、Pillow>=9.5.0</li>
                        <li>进程管理：psutil>=5.9.0、gc（内置）</li>
                        <li>日志与异常：traceback（内置）、logging（内置）</li>
                    </ul>
                </div>
                <!-- 权限依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.3 权限依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>马帮ERP：供应链模块、仓库模块、报表模块的查看/导出/筛选权限</li>
                        <li>海仓国际：库存管理模块、实时库存的查看/导出权限</li>
                        <li>本地文件：导出文件夹、汇总模板文件的<b>读/写/删除/新建</b>权限</li>
                        <li>系统权限：允许执行taskkill命令、允许win32com调用WPS/Excel</li>
                        <li>网络权限：允许访问马帮ERP（https://www.mabangerp.com）、海仓国际官网</li>
                    </ul>
                </div>
                <!-- 配置文件依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.4 配置文件依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>核心配置：《配置文件.xlsx》（glv['SETTING_TABLE']），包含登录信息、导出文件路径</li>
                        <li>汇总模板：《菲律宾进销存2.0.xlsx》（glv['SUMMARY_TEMPLATE']），包含各仓工作表、计算公式</li>
                        <li>全局变量：glv（package.variables），包含重试次数、模板路径、元素选择器等</li>
                        <li>工具模块：tools.py，包含copy_and_rename_excel、format_sheet等通用工具函数</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- 折叠面板交互逻辑（完整支持单个点击、图标旋转、全部联动） -->
    <script>
        // 页面加载完成后初始化所有交互
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 单个折叠面板点击事件（含图标旋转）
            const singleCollapseBtns = document.querySelectorAll('.single-collapse-btn');
            singleCollapseBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 切换当前面板的active类（控制内容展开/收起）
                    this.classList.toggle('active');
                    // 同步图标旋转状态
                    const icon = this.querySelector('i.fa-chevron-down');
                    if (icon) {
                        icon.style.transform = this.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0)';
                    }
                });
            });

            // 2. 全部展开/收起按钮 - 异常处理机制板块
            const allCollapseBtn = document.getElementById('allCollapseBtn');
            if (allCollapseBtn) {
                allCollapseBtn.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isActive = this.classList.contains('active');
                    // 联动当前板块下所有单个面板
                    const sectionSingleBtns = this.parentElement.querySelectorAll('.single-collapse-btn');
                    sectionSingleBtns.forEach(btn => {
                        if (isActive) {
                            btn.classList.add('active');
                            btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(180deg)';
                        } else {
                            btn.classList.remove('active');
                            btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(0)';
                        }
                    });
                    // 旋转全部按钮自身图标
                    const icon = this.querySelector('i.fa-chevron-down');
                    icon.style.transform = isActive ? 'rotate(180deg)' : 'rotate(0)';
                });
            }

            // 3. 全部展开/收起按钮 - 数据传输规范板块
            const allCollapseBtn2 = document.getElementById('allCollapseBtn2');
            if (allCollapseBtn2) {
                allCollapseBtn2.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isActive = this.classList.contains('active');
                    // 联动当前板块下所有单个面板
                    const sectionSingleBtns = this.parentElement.querySelectorAll('.single-collapse-btn');
                    sectionSingleBtns.forEach(btn => {
                        if (isActive) {
                            btn.classList.add('active');
                            btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(180deg)';
                        } else {
                            btn.classList.remove('active');
                            btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(0)';
                        }
                    });
                    // 旋转全部按钮自身图标
                    const icon = this.querySelector('i.fa-chevron-down');
                    icon.style.transform = isActive ? 'rotate(180deg)' : 'rotate(0)';
                });
            }
        });
    </script>
</body>
</html>
