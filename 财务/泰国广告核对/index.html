<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>泰国站点广告核对</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        primaryLight: '#E8F3FF',
                        primaryDark: '#0E42CC',
                        secondary: '#0E2B8A',
                        light: '#F9FBFF',
                        dark: '#1D2129',
                        gray: '#86909C',
                        grayLight: '#F0F2F5',
                        grayBorder: '#E5E6EB'
                    },
                    fontFamily: {
                        sans: ['Microsoft YaHei', 'PingFang SC', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 2px 12px 0 rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 6px 16px 0 rgba(0, 0, 0, 0.08)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .collapse-item {
                border-bottom: 1px solid theme('colors.grayBorder');
            }
            /* 通用折叠面板展开样式 - 提升优先级确保生效 */
            .collapse-header.active + .collapse-content {
                max-height: 2000px !important;
                opacity: 1 !important;
                padding-top: 1rem !important;
                transition: all 0.4s ease-in-out !important;
            }
            .collapse-content {
                max-height: 0 !important;
                opacity: 0 !important;
                transition: all 0.4s ease-in-out !important;
                overflow: hidden !important;
                padding-top: 0 !important;
            }
            .step-card {
                border-left: 3px solid theme('colors.primaryLight');
                padding-left: 1rem;
                margin-bottom: 1.5rem;
                position: relative;
            }
            .step-card::before {
                content: '';
                position: absolute;
                left: -3px;
                top: 0;
                height: 100%;
                width: 3px;
                background: linear-gradient(to bottom, theme('colors.primary'), transparent);
                opacity: 0.3;
            }
            .table-hover-row {
                transition: background-color 0.2s ease;
            }
            /* 折叠图标旋转动画 - 绑定active类，确保交互反馈 */
            .collapse-header i.fa-chevron-down {
                transition: transform 0.3s ease-in-out !important;
                transform: rotate(0) !important;
            }
            .collapse-header.active i.fa-chevron-down {
                transform: rotate(180deg) !important;
            }
        }
    </style>
</head>
<body class="bg-light text-dark font-sans min-h-screen">
    <!-- 页面头部 -->
    <header class="py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-primaryLight">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-[clamp(22px,4vw,32px)] font-bold text-secondary mb-3">
                泰国站点广告核对-自动化处理流程
            </h1>
            <p class="text-gray text-base sm:text-lg max-w-3xl mx-auto">
                泰国多平台店铺广告费自动化核对方案 | 石墨文档文件导出合并 · 战斧浏览器多店铺批量导出 · 多平台数据清洗 · 广告费自动核对 · 缺失店铺数据补充 · 跨境/本土店汇率自动处理
            </p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6">
        <!-- 板块1：业务背景 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-bullseye text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">一、业务背景</h2>
            </div>
            <!-- 实施目的 -->
            <div class="pl-12 text-base leading-relaxed text-dark/85 mb-6">
                <h3 class="font-medium text-dark mb-2">1.1 实施目的</h3>
                <p>财务/运营部门需完成<b>泰国Lazada/Shopee/TikTok（含本土/跨境店）多平台数百个店铺</b>的广告费自动化导出与精准核对，核心是从<b>石墨文档</b>导出广告费充值底表，通过<b>战斧浏览器</b>批量访问各平台店铺后台提取广告费实际消费数据，按平台规则清洗数据（含跨境店1.07汇率处理、优惠券/优惠额度精准提取），与石墨底表进行<code>日期+金额+店铺</code>三重匹配核对，自动识别数据差异并补录，对底表中缺失的店铺数据进行自动化补充，扣除平台赠送红包金额后生成含<b>平台时间、平台金额、处理后金额、核对结果、差异说明</b>的标准化Excel核对结果，实现泰国多平台广告费核对的自动化、标准化、可追溯化。</p>
                <p class="mt-2">人工完成多平台多店铺广告费导出、数据清洗、跨境/本土店汇率手动计算、逐行核对、差异/缺失数据人工补录等工作，存在<b>操作繁琐、效率极低、数据易出错、汇率处理不统一、差异排查困难、缺失数据补录耗时</b>等痛点，通过自动化流程实现多平台广告费的一键导出、智能清洗、自动核对，精准记录核对结果与差异，提升广告费核对效率与准确性。</p>
            </div>
            <!-- 基本信息 -->
            <div class="pl-12 overflow-x-auto">
                <h3 class="font-medium text-dark mb-2">1.2 基础信息</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">流程名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">所属部门</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">操作频率</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">核心目标</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">战斧_泰国_全部店铺广告费核对</td>
                            <td class="p-3 border border-grayBorder">财务部</td>
                            <td class="p-3 border border-grayBorder">月度执行（手动触发）</td>
                            <td class="p-3 border border-grayBorder">自动导出石墨底表+战斧多店铺广告费、多平台数据清洗、广告费自动核对、缺失数据补充、生成标准化Excel核对结果</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 板块2：功能模块 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-desktop text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">二、功能模块</h2>
            </div>
            <!-- 应用系统 -->
            <div class="pl-12 mb-6">
                <h3 class="font-medium text-dark mb-2">2.1 涉及应用系统</h3>
                <p class="text-sm text-dark/80 mb-3">系统类型：浏览器网页/客户端/自动化工具/共享存储服务 | 验证码类型：点选验证 | 多账号/多店铺独立校验（按平台/店铺区分）</p>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="bg-primaryLight text-left">
                                <th class="p-3 border border-grayBorder font-medium text-primary">系统名称</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">类型</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">需账号密码</th>
                                <th class="p-3 border border-grayBorder font-medium text-primary">核心用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">石墨文档</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">广告费充值底表导出、多表数据合并、充值记录数据源提供</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">战斧浏览器</td>
                                <td class="p-3 border border-grayBorder">客户端/自动化工具</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">多店铺批量登录、各平台广告费导出、跨店铺操作管理、插件化自动化执行</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">Lazada/Shopee/TikTok泰国后台</td>
                                <td class="p-3 border border-grayBorder">浏览器网页</td>
                                <td class="p-3 border border-grayBorder">Yes（按店铺）</td>
                                <td class="p-3 border border-grayBorder">店铺广告费数据提取、交易历史查询、日期范围筛选、数据导出</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">Python运行环境</td>
                                <td class="p-3 border border-grayBorder">后台运行</td>
                                <td class="p-3 border border-grayBorder">无</td>
                                <td class="p-3 border border-grayBorder">跨系统逻辑执行、数据清洗、自动核对、异常监控、进程管理</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">WPS（Excel）</td>
                                <td class="p-3 border border-grayBorder">客户端</td>
                                <td class="p-3 border border-grayBorder">无</td>
                                <td class="p-3 border border-grayBorder">核对结果生成、数据写入、公式计算、标准化文件输出</td>
                            </tr>
                            <tr class="table-hover-row hover:bg-primaryLight/50">
                                <td class="p-3 border border-grayBorder">共享存储服务</td>
                                <td class="p-3 border border-grayBorder">网络共享</td>
                                <td class="p-3 border border-grayBorder">Yes</td>
                                <td class="p-3 border border-grayBorder">导出文件存储、核对结果归档、全局变量路径配置、多用户数据共享</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 模块概览 -->
            <div class="pl-12 overflow-x-auto mb-6">
                <h3 class="font-medium text-dark mb-2">2.2 核心模块概览</h3>
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primaryLight text-left">
                            <th class="p-3 border border-grayBorder font-medium text-primary">模块名称</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">涉及平台</th>
                            <th class="p-3 border border-grayBorder font-medium text-primary">输出文件类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">环境清理与路径初始化</td>
                            <td class="p-3 border border-grayBorder">Python+系统命令</td>
                            <td class="p-3 border border-grayBorder">无（环境准备）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">石墨文档登录与文件导出合并</td>
                            <td class="p-3 border border-grayBorder">石墨文档+Python+pandas</td>
                            <td class="p-3 border border-grayBorder">XLSX（合并后广告费充值底表）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">战斧浏览器登录与多店铺导出</td>
                            <td class="p-3 border border-grayBorder">战斧浏览器+各平台后台+Python</td>
                            <td class="p-3 border border-grayBorder">XLSX/CSV（各店铺广告费原始数据）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">多平台广告费数据清洗</td>
                            <td class="p-3 border border-grayBorder">Python+pandas+正则表达式</td>
                            <td class="p-3 border border-grayBorder">无（内存清洗后数据）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">广告费自动核对与差异识别</td>
                            <td class="p-3 border border-grayBorder">Python+pandas+openpyxl</td>
                            <td class="p-3 border border-grayBorder">无（核对结果内存数据）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">缺失店铺数据自动化补充</td>
                            <td class="p-3 border border-grayBorder">Python+openpyxl+各平台清洗数据</td>
                            <td class="p-3 border border-grayBorder">无（底表数据补充）</td>
                        </tr>
                        <tr class="table-hover-row hover:bg-primaryLight/50">
                            <td class="p-3 border border-grayBorder">核对结果标准化生成与保存</td>
                            <td class="p-3 border border-grayBorder">Python+openpyxl+共享存储</td>
                            <td class="p-3 border border-grayBorder">XLSX（标准化广告费核对结果）</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- 核心能力 -->
            <div class="pl-12">
                <h3 class="font-medium text-dark mb-2">2.3 核心自动化能力</h3>
                <ul class="list-disc pl-6 text-sm space-y-2 text-dark/85">
                    <li>流程启动前自动清理环境，强制终止战斧浏览器/WPS残留进程（taskkill），关闭所有Chrome窗口，避免进程占用导致文件/页面操作失败</li>
                    <li>石墨文档自动登录+点选验证码自动处理，批量导出4份广告费相关表格并自动合并，生成统一的广告费充值底表，支持多表数据拼接与格式标准化</li>
                    <li>战斧浏览器自动化登录与店铺管理，支持泰国Lazada/Shopee/TikTok数百个店铺批量打开、广告费一键导出，按平台分类存储原始数据</li>
                    <li>Shopee3PF跨境店多账号自动切换登录，支持不同账号下店铺广告费独立导出，实现跨账号店铺统一管理</li>
                    <li>跨境店汇率自动处理，非指定跨境店铺广告费金额默认乘以1.07汇率，指定跨境店铺直接使用原始金额，汇率规则可配置</li>
                    <li>多平台广告费精准提取，Lazada优惠券当日多次出现取最大额、Shopee优惠额度通过正则提取Paid Credit、TikTok区分本土/跨境店数据规则</li>
                    <li>广告费智能核对，按<code>店铺+日期+金额</code>三重维度匹配石墨底表与平台实际数据，自动识别数据差异并标记核对结果（一致/不一致）</li>
                    <li>差异数据自动化补录，将平台有数据但底表无记录的广告费数据，以「RPA自动补录」类型写入底表，实现数据无遗漏</li>
                    <li>缺失店铺自动补充，识别底表中未包含但本次导出有数据的店铺，以「店铺缺少由RPA自动补充」类型写入底表，完成数据全量覆盖</li>
                    <li>平台赠送红包金额自动抵扣，读取底表「平台赠送」sheet数据，按店铺自动扣除对应金额，无需人工手动计算</li>
                    <li>标准化核对结果生成，在底表中新增「平台时间、平台金额、处理后金额、核对是否一致、说明」列，写入公式实现金额自动计算与结果判定</li>
                    <li>全流程重试机制，所有核心操作（登录、导出、清洗、核对）均支持可配置重试次数，单次失败不终止整体流程，提升稳定性</li>
                    <li>异常容错与日志记录，所有操作均做异常捕获，记录完整堆栈信息，单个店铺处理失败跳过并继续后续店铺，确保流程连续性</li>
                </ul>
            </div>
        </section>

        <!-- 板块3：异常处理机制 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exclamation-triangle text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">三、异常处理机制</h2>
            </div>
            <div class="pl-12 space-y-3">
                <!-- 全部展开/收起按钮 - 绑定唯一ID，确保联动 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg cursor-pointer transition-all duration-300 hover:bg-primaryLight/80" id="allCollapseBtn">
                    <span class="font-medium text-primary">展开/收起所有异常处理规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary"></i>
                </div>

                <!-- 步骤1：环境清理与路径初始化 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤1：环境清理与文件路径初始化</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>执行taskkill终止战斧浏览器/WPS进程、xbot.web.close_all关闭Chrome所有窗口时，捕获所有异常不终止流程，避免进程不存在导致启动失败</li>
                                <li>输出文件夹（含处理完成、石墨文档、战斧各平台子文件夹）通过os.makedirs+exist_ok=True实现自动创建与容错，无需提前手动创建</li>
                                <li>按当前时间戳生成唯一文件夹存储本次导出所有文件，避免重复执行时文件覆盖，确保数据独立性</li>
                                <li>全局变量路径初始化时做非空校验，核心路径（Output_Folder）未配置则直接抛出异常，避免后续文件操作失败</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤2：石墨文档登录与文件导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤2：石墨文档登录与文件导出合并</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>石墨文档打开时最多重试指定次数（retry_times），每次重试包含页面重载，超时则抛出「网络加载超时」明确异常</li>
                                <li>登录前检测是否已登录，已登录则直接跳过登录流程，避免重复登录导致的验证码触发</li>
                                <li>登录过程中触发点选验证码时，调用自动化验证工具处理，验证失败自动重试登录，提升登录成功率</li>
                                <li>表格导出时最多重试指定次数，每次重试后关闭可能残留的「另存为」弹窗，避免弹窗遮挡导致导出失败</li>
                                <li>导出后强制校验文件存在性，文件未生成则标记导出失败，继续后续表格导出，单个表格失败不终止整体导出流程</li>
                                <li>多表合并前校验导出文件数量，非4份则抛出「石墨文档导出异常」，避免缺失底表导致后续核对无数据源</li>
                                <li>读取石墨表格时做数据格式容错，空值填充为空白字符串，日期列转换失败时做异常捕获，不终止数据读取</li>
                                <li>多表数据合并时按指定列筛选有效数据，过滤空店铺、空金额记录，避免无效数据参与后续核对</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤3：战斧浏览器登录与店铺导出 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤3：战斧浏览器登录与多店铺导出</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>战斧浏览器启动后自动检测并关闭「设备到期提醒」弹窗，避免弹窗遮挡后续操作元素，最多重试3次弹窗关闭</li>
                                <li>战斧浏览器登录支持可配置重试次数，账号密码验证失败则抛出明确异常，终止流程并提示检查账号密码</li>
                                <li>店铺搜索时校验搜索结果数量，无结果则标记「战斧浏览器不存在该店铺」并跳过，不终止后续店铺处理</li>
                                <li>店铺打开按钮校验，非「打开店铺」按钮则直接跳过，避免点击错误按钮导致的操作异常</li>
                                <li>各平台店铺广告费导出均支持独立重试，单次导出失败则重启店铺插件并重新导出，最多重试指定次数</li>
                                <li>导出后强制校验文件存在性，XLSX/CSV文件未生成则标记导出失败，跳过该店铺并继续后续店铺</li>
                                <li>Shopee3PF跨境店多账号切换时，先执行登出操作再登录新账号，登出/登录均做加载状态监控，确保账号切换成功</li>
                                <li>店铺导出完成后自动关闭店铺窗口，释放系统资源，避免多窗口打开导致的浏览器卡顿</li>
                                <li>所有页面操作后均做元素存在性校验，元素未显示则等待后重试，避免页面加载未完成导致的操作无效</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤4：多平台广告费数据清洗 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤4：多平台广告费数据清洗</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>读取各平台广告费文件时，支持多表头格式容错（Lazada/XLSX固定表头、Shopee/CSV表头5/6行自适应），自动适配不同平台文件格式</li>
                                <li>数据筛选时做列名容错，TikTok区分中英文列名（交易类型/Transaction type），自动识别并适配，避免列名不存在导致的KeyError</li>
                                <li>日期列转换时使用errors='coerce'，无效日期转换为NaT并过滤，避免单个无效日期导致的整表处理失败</li>
                                <li>金额列强制转换为浮点数，转换失败则标记该条数据无效并过滤，确保金额计算准确性</li>
                                <li>Lazada优惠券处理时，无符合条件数据则直接跳过，不抛出异常，确保清洗流程连续性</li>
                                <li>Shopee优惠额度正则提取失败时，直接使用原始金额，避免正则匹配失败导致的单条数据丢失</li>
                                <li>数据清洗后校验有效数据量，无有效数据则标记该店铺「导出的广告费中没有任何数据」并跳过，不参与后续核对</li>
                                <li>跨境店汇率计算时做数值精度控制，乘以1.07后保留2位小数，避免浮点精度问题导致的金额核对不一致</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤5：广告费自动核对与差异补录 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤5：广告费自动核对与差异补录</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>核对前校验石墨底表中是否存在该店铺数据，无数据则标记「底表中不存在该店铺」并加入缺失店铺列表，后续统一补充</li>
                                <li>日期匹配时做格式标准化，所有日期统一转换为「YYYY-MM-DD」格式，避免不同日期格式导致的匹配失败</li>
                                <li>金额匹配时做浮点精度容错，允许微小精度差异（如0.01），避免浮点计算问题导致的误判为「不一致」</li>
                                <li>核对过程中单个单元格写入失败则捕获异常，继续后续单元格写入，避免单个单元格错误导致的整行核对失败</li>
                                <li>公式写入时指定单元格数字格式（0.00），确保金额列显示标准化，避免科学计数法等显示异常</li>
                                <li>差异数据识别时做数据去重，避免重复补录相同的「店铺+日期+金额」数据，确保底表数据唯一性</li>
                                <li>差异数据补录时按平台分类填写「平台类型」列（LAZADA/SHOPEE/TIKTOK），确保数据分类清晰</li>
                                <li>单个店铺核对失败则捕获完整堆栈信息并记录日志，跳过该店铺继续后续店铺，不终止整体核对流程</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤6：缺失店铺补充与红包抵扣 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤6：缺失店铺补充与平台红包抵扣</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>缺失店铺补充时按平台调用对应清洗方法，确保补充数据的规则与正常核对数据一致，无规则偏差</li>
                                <li>补充数据前再次校验文件存在性，文件已删除则标记补充失败并记录日志，跳过该店铺</li>
                                <li>读取「平台赠送」sheet时做行级异常捕获，单行列数据格式错误（日期/金额/店铺）则记录错误行并跳过，不终止红包抵扣流程</li>
                                <li>红包金额计算时做数值精度控制，累加后保留2位小数，确保抵扣金额准确性</li>
                                <li>红包抵扣时校验店铺匹配性，无对应店铺则跳过该条红包记录，避免误抵扣到其他店铺</li>
                                <li>抵扣金额写入时做非空校验，原说明列有数值则做减法计算，无数值则直接写入抵扣后金额，避免公式错误</li>
                                <li>缺失店铺金额汇总时做数据筛选，仅汇总「店铺缺少由RPA自动补充」类型数据，避免汇总错误数据</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 步骤7：核对结果保存与通用工具 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">步骤7：核对结果保存与通用工具类</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <p class="mb-2 font-medium text-dark/80">异常处理规则：</p>
                            <ul class="list-disc pl-6 space-y-1 mb-3 text-sm">
                                <li>核对结果保存前强制刷新Excel公式，确保所有自动计算的金额与核对结果为最新值，避免保存旧数据</li>
                                <li>保存文件时做路径权限校验，无写入权限则抛出「文件写入失败」异常并提示检查文件夹权限</li>
                                <li>多次保存文件时做文件锁定检测，若文件被WPS占用则等待后重试，最多重试指定次数</li>
                                <li>CommonUtil工具类禁止实例化（__new__抛出异常），仅提供静态方法，确保工具类的通用性和安全性</li>
                                <li>通用点击方法（CommonUtil.click）内置窗口激活、重试机制，最多重试10次，每次间隔1s，提升页面操作成功率</li>
                                <li>点击操作支持ignore_error忽略错误模式，非核心操作可选择不抛出异常，保证流程整体连续性</li>
                                <li>10次点击重试失败则抛出「click timeout, element not exists」明确异常，记录目标元素标识，方便问题定位</li>
                                <li>所有页面操作使用非模拟点击（simulative=False），确保特殊元素、动态元素点击有效，避免模拟点击兼容性问题</li>
                                <li>全流程日志分级记录，INFO记录正常操作流程，WARNING记录非致命异常，ERROR记录致命异常与堆栈信息，方便问题排查</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块4：数据传输规范 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-exchange text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">四、数据传输规范</h2>
            </div>
            <div class="pl-12 space-y-3">
                <!-- 全部展开/收起按钮 - 绑定唯一ID，确保联动 -->
                <div class="collapse-header flex justify-between items-center py-3 px-4 bg-primaryLight/50 rounded-lg cursor-pointer transition-all duration-300 hover:bg-primaryLight/80" id="allCollapseBtn2">
                    <span class="font-medium text-primary">展开/收起所有数据传输规则</span>
                    <i class="fa fa-chevron-down text-xs text-primary"></i>
                </div>

                <!-- 规则1：石墨文档文件导出与合并规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则1：石墨文档文件导出与合并规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>固定导出4份表格：泰国广告充值（BBL-1676）、泰国广告充值Shopee+tiktok-万里汇付卡、泰国广告充值Lazada+tiktok-万里汇付卡、tk品牌店铺广告充值，缺一不可</li>
                                <li>导出格式固定为XLSX，文件命名规则为「{年份}{原文件名}_{时间戳}.xlsx」，确保文件名唯一性</li>
                                <li>导出路径固定为「{创建文件夹}/石墨文档」，所有石墨文件统一归档，方便后续读取</li>
                                <li>多表合并仅提取有效数据列，过滤空行、空店铺记录，合并后数据统一写入「泰国广告充值（BBL-1676）」的「店铺余额充值」sheet</li>
                                <li>日期列统一转换为「YYYY/MM/DD」格式，金额列保留2位小数，确保合并后数据格式标准化</li>
                                <li>合并后在「店铺余额充值」sheet新增「付款时间」列（I列），用于后续日期范围筛选，列名格式与原表保持一致</li>
                                <li>合并完成后保存原文件，不覆盖原始导出数据，确保数据源可追溯</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则2：战斧浏览器多店铺导出规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则2：战斧浏览器多店铺导出规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>导出路径按「{创建文件夹}/战斧/{平台}」分类，Lazada/Shopee/TikTok数据独立存储，平台名称小写（lazada/shopee/tiktok）</li>
                                <li>文件命名规则固定为「{店铺缩写}_广告费导出.{格式}」，Lazada/TikTok为XLSX格式，Shopee/Shopee3PF为CSV格式</li>
                                <li>导出日期范围固定为「上月1日~上月最后一日」，自动计算无需人工配置，确保核对数据为整月数据</li>
                                <li>店铺搜索按「shop_name_list」全局变量批量执行，列表中店铺逐一处理，无遗漏、不重复</li>
                                <li>Shopee3PF跨境店单独处理，导出路径为「{创建文件夹}/战斧/shopee」，文件命名包含「泰国跨境」标识，方便区分</li>
                                <li>导出完成后强制校验文件大小，空文件（大小为0）则标记导出失败，重新执行导出流程</li>
                                <li>单个店铺导出失败则加入全局异常列表，流程结束后打印失败店铺名称，方便人工兜底处理</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则3：多平台广告费提取规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则3：多平台广告费提取规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>Lazada提取规则：仅筛选「WalletType=预付/优惠券」且「Status=SUCCESS」的记录，日期取「Date & Time」，金额取「Amount」</li>
                                <li>Lazada优惠券处理：当日出现≥2次则取金额最大的1条，当日出现1次则直接取，确保单日内仅保留1条有效优惠券记录</li>
                                <li>Shopee本土店提取规则：仅筛选「Description=Top-Up Credit/Top-Up and Free ads Credit/Auto Top-Up」的记录，日期取「Date」，金额取「Amount」</li>
                                <li>Shopee优惠额度处理：「Top-Up and Free ads Credit」类型通过正则「Paid Credit: (\d+\.\d+)」提取实际付费金额，替代原始金额</li>
                                <li>Shopee3PF跨境店提取规则：仅筛选「描述=充值额度/充值和免费广告额度」的记录，日期取「时间」，金额取「总额」</li>
                                <li>Shopee3PF优惠额度处理：「充值和免费广告额度」类型通过正则「付费额度：(\d+\.\d+)」提取实际付费金额</li>
                                <li>TikTok本土店提取规则：仅筛选「Type = GMV Payment for TikTok Ads」的记录，日期取「Order created time」，金额取「Total settlement amount」（取绝对值）</li>
                                <li>TikTok跨境店提取规则：仅筛选「交易类型=充值 GMV Pay/Transaction type=Add balance」且「Status=Success」的记录，日期取交易时间，金额取实际充值金额</li>
                                <li>所有平台提取后均生成「原始时间+金额+标准化日期（YYYY-MM-DD）」的三元组数据，确保数据格式统一</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则4：广告费核对与数据补录规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则4：广告费核对与数据补录规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>核对匹配维度：按「店铺缩写（B列）+ 标准化日期 + 金额（C列）」三重维度精准匹配，三者完全一致才判定为「核对一致」</li>
                                <li>日期筛选规则：仅核对「上月1日~上月最后一日」的记录，非上月数据自动过滤，不参与核对</li>
                                <li>汇率处理规则：跨境店白名单（cb_shop_list）内店铺直接使用原始金额，白名单外店铺金额×1.07并保留2位小数</li>
                                <li>核对结果写入：匹配成功则在O/P/Q/R/S列分别写入「平台时间/平台金额/处理后金额/核对结果/空值」</li>
                                <li>公式写入规则：Q列（处理后金额）=P列×1.07（非跨境店）/P列（跨境店），R列（核对结果）=IF(C列=Q列,"一致","不一致")</li>
                                <li>差异数据补录：平台有数据但底表无记录的，在底表末尾追加，D列填「RPA自动补录」，F列填对应平台类型，A/B/C列填标准化日期/店铺/处理后金额</li>
                                <li>缺失店铺补充：底表无店铺但平台有数据的，在底表末尾追加，D列填「店铺缺少由RPA自动补充」，F列填对应平台类型，其余列按清洗后数据填写</li>
                                <li>补录/补充数据均按「标准化日期」升序排列，确保底表数据时间顺序一致</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则5：平台红包抵扣与金额汇总规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则5：平台红包抵扣与金额汇总规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>平台红包读取规则：仅读取「平台赠送」sheet中「上月1日~上月最后一日」的记录，按店铺累加红包金额，保留2位小数</li>
                                <li>红包抵扣规则：按店铺匹配底表「店铺余额充值」sheet，在S列（说明）中扣除对应红包金额，原金额-红包金额=抵扣后金额</li>
                                <li>店铺金额汇总规则：按店铺累加「处理后金额（Q列）+ RPA自动补录金额（C列）+ 店铺缺少补充金额（C列）」，汇总结果写入S列右侧列</li>
                                <li>汇总范围：仅汇总上月数据，非上月的补录/补充数据自动过滤，确保汇总金额为当月实际广告费</li>
                                <li>抵扣/汇总后金额均保留2位小数，确保财务数据精度要求</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 规则6：输出文件与全局变量传输规范 -->
                <div class="collapse-item py-2">
                    <div class="collapse-header flex justify-between items-center py-2 px-0 cursor-pointer group single-collapse-btn">
                        <span class="font-medium text-dark group-hover:text-primary transition-colors">规则6：输出文件与全局变量传输规范</span>
                        <i class="fa fa-chevron-down text-xs text-gray group-hover:text-primary"></i>
                    </div>
                    <div class="collapse-content pl-2 text-gray">
                        <div class="step-card">
                            <ol class="list-decimal pl-6 space-y-1 text-sm">
                                <li>输出文件类型：固定为XLSX格式，兼容WPS/Excel所有版本，支持公式自动计算、单元格格式设置</li>
                                <li>主输出文件：石墨文档合并后的「泰国广告充值（BBL-1676）.xlsx」，所有核对结果、补录数据、公式均写入该文件</li>
                                <li>文件存储路径：「Output_Folder/{时间戳}」存储本次所有导出/中间文件，「Output_Folder/处理完成」用于最终结果归档</li>
                                <li>核心入参全局变量（glv）：retry_times（重试次数）、shop_name_list（店铺列表）、Output_Folder（输出根路径）、dict_shopurl（店铺地址映射）、dict_shopurl_user1/user2（Shopee3PF账号店铺映射）</li>
                                <li>过程变量全局变量（glv）：tk_output_error_shop（TikTok导出失败店铺）、dict_missing_shops（缺失店铺列表）、i_select_idx（店铺选择索引）、i_start_time/i_end_time（日期范围）</li>
                                <li>变量类型规范：路径类为绝对路径、次数类为整数、金额类为浮点数（保留2位）、日期类为标准化字符串（YYYY-MM-DD/YYYY/MM/DD）</li>
                                <li>店铺地址映射：dict_shopurl按「店铺缩写:后台地址」键值对存储，确保战斧浏览器可直接访问对应店铺后台</li>
                                <li>全局变量生命周期：贯穿整个流程，流程结束后保留，方便问题排查与日志分析</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 板块5：系统依赖 -->
        <section class="bg-white rounded-xl p-6 shadow-card hover:shadow-card-hover transition-shadow duration-300">
            <div class="flex items-center mb-4">
                <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-cogs text-primary"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-dark">五、系统依赖</h2>
            </div>
            <div class="pl-12 space-y-4">
                <!-- 环境依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.1 运行环境依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>操作系统：Windows 10/11 64位（需支持taskkill、os.system系统命令，用于进程清理）</li>
                        <li>浏览器：Google Chrome 90.0+（支持石墨文档登录、点选验证码处理、多页面加载）</li>
                        <li>自动化工具：战斧浏览器（最新版，支持店铺管理、插件化自动化、多账号切换）</li>
                        <li>办公软件：WPS Office 2021+/Microsoft Excel 2016+（支持XLSX/CSV格式、公式重算、无锁文件读写）</li>
                        <li>运行时：Python 3.8+（需安装指定第三方库，支持数据处理、自动化操作、Excel读写）</li>
                        <li>自动化框架：xbot/xbot_visual（影刀RPA框架，提供网页自动化、图像识别、窗口管理核心能力）</li>
                        <li>存储服务：网络共享存储/本地磁盘（支持多文件夹创建、XLSX/CSV文件写入、多用户访问）</li>
                        <li>网络环境：稳定的网络连接，可正常访问石墨文档、战斧浏览器、泰国Lazada/Shopee/TikTok后台，无代理限制</li>
                    </ul>
                </div>
                <!-- Python库依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.2 Python第三方库依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>自动化操作：xbot、xbot_visual（影刀核心库，网页操作、图像识别、窗口管理、文件下载）</li>
                        <li>数据处理：pandas（多表合并、数据筛选、日期转换、数值计算）、numpy（浮点精度控制、数值运算）</li>
                        <li>Excel操作：openpyxl（Excel文件读写、公式写入、单元格格式设置、多sheet操作）</li>
                        <li>文件操作：os（路径处理、文件夹创建、进程调用）、glob（文件路径匹配、多文件遍历）</li>
                        <li>正则处理：re（内置，Shopee优惠额度、Paid Credit精准提取）</li>
                        <li>时间处理：datetime（内置，日期计算、格式转换、时间戳生成）、time（内置，延时、等待）</li>
                        <li>日志与异常：xbot.app.logging（系统日志记录）、traceback（内置，异常堆栈信息捕获）</li>
                        <li>窗口操作：xbot.win32（内置，窗口激活、键盘指令、鼠标操作）</li>
                        <li>验证码处理：xbot_extensions.activity_jfbym（点选验证码自动化处理）</li>
                        <li>战斧扩展：xbot_extensions.activity_f31a891f（战斧浏览器店铺管理、插件启动、登录）</li>
                    </ul>
                </div>
                <!-- 权限依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.3 权限依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>石墨文档：拥有指定广告费表格的「查看/导出/下载」权限，可正常访问表格内容，无下载限制</li>
                        <li>战斧浏览器：拥有管理员账号权限，可「登录/管理店铺/打开店铺/启动插件」，支持多店铺批量操作</li>
                        <li>泰国各平台后台：按店铺拥有「登录/访问广告模块/查询交易历史/导出数据」权限，可查看广告费明细</li>
                        <li>Shopee3PF跨境店：拥有多账号「登录/登出/广告数据导出」权限，账号无操作时长与次数限制</li>
                        <li>存储服务：输出根路径（glv['Output_Folder']）的「读/写/新建/删除」权限，可创建多级子文件夹并写入文件</li>
                        <li>系统权限：允许执行taskkill命令（终止残留进程）、允许os.system调用系统命令、允许创建多进程/多线程</li>
                        <li>浏览器权限：允许Chrome/战斧浏览器最大化启动、允许同时打开多个窗口、允许非模拟点击/输入</li>
                        <li>文件权限：允许读取/写入XLSX/CSV格式文件，无文件加密/保护限制，生成的文件可被多用户访问/编辑</li>
                    </ul>
                </div>
                <!-- 配置文件依赖 -->
                <div class="bg-primaryLight/30 rounded-lg p-4">
                    <h3 class="font-medium text-primary mb-2">5.4 配置文件与模块依赖</h3>
                    <ul class="list-disc pl-6 text-sm space-y-1">
                        <li>全局变量：glv（package.variables），核心参数：retry_times、shop_name_list、Output_Folder、dict_shopurl、dict_shopurl_user1/user2、tk_output_error_shop、dict_missing_shops</li>
                        <li>自定义工具模块：tools.py（提供get_time/convert_to_ymd/get_last_month_range等方法，时间处理与格式转换）</li>
                        <li>战斧扩展模块：xbot_extensions.activity_f31a891f（zf_Main，战斧浏览器登录、插件启动、店铺管理）</li>
                        <li>验证码扩展模块：xbot_extensions.activity_jfbym（human_click/cs_space_same_object_captcha，点选验证码处理）</li>
                        <li>自定义业务类：Shimo（石墨文档操作封装）、Zhanfu（战斧浏览器+多平台广告费处理核心封装），封装业务逻辑</li>
                        <li>通用工具类：CommonUtil（静态类，封装通用点击方法，提供重试/激活/容错能力，禁止实例化）</li>
                        <li>元素标识：zf_（战斧浏览器元素前缀）、ty_（各平台后台元素前缀），所有页面元素标识固定，确保定位准确</li>
                        <li>图像资源：点选验证码背景/确认按钮图像、平台加载中图像，需与实际页面图像一致，确保识别准确性</li>
                        <li>配置常量：conversion_rate（汇率1.07）、cb_shop_list（跨境店白名单）、usd_pay_shop（美金充值店铺），可按需配置修改</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- 折叠面板交互逻辑 - 修复所有问题：绑定所有点击事件、图标旋转、全部联动 -->
    <script>
        // 页面加载完成后初始化所有交互，确保DOM元素已完全加载
        document.addEventListener('DOMContentLoaded', function() {
            // 通用方法：切换单个面板状态（含active类切换、图标旋转）
            const toggleSingleCollapse = (btn) => {
                btn.classList.toggle('active');
                const icon = btn.querySelector('i.fa-chevron-down');
                if (icon) {
                    icon.style.transform = btn.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0)';
                }
            };

            // 通用方法：切换全部面板状态（联动单个面板+自身图标旋转）
            const toggleAllCollapse = (allBtn, sectionSelector) => {
                allBtn.classList.toggle('active');
                const isActive = allBtn.classList.contains('active');
                // 联动当前板块下所有单个折叠面板
                const singleBtns = allBtn.closest(sectionSelector).querySelectorAll('.single-collapse-btn');
                singleBtns.forEach(btn => {
                    if (isActive) {
                        btn.classList.add('active');
                        btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(180deg)';
                    } else {
                        btn.classList.remove('active');
                        btn.querySelector('i.fa-chevron-down').style.transform = 'rotate(0)';
                    }
                });
                // 自身图标旋转同步
                const allIcon = allBtn.querySelector('i.fa-chevron-down');
                allIcon.style.transform = isActive ? 'rotate(180deg)' : 'rotate(0)';
            };

            // 1. 绑定所有单个折叠面板的点击事件（解决点不开问题）
            const allSingleBtns = document.querySelectorAll('.single-collapse-btn');
            allSingleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    toggleSingleCollapse(this);
                });
            });

            // 2. 绑定异常处理机制板块「全部展开/收起」按钮（联动单个面板）
            const allCollapseBtn = document.getElementById('allCollapseBtn');
            if (allCollapseBtn) {
                allCollapseBtn.addEventListener('click', function() {
                    toggleAllCollapse(this, 'section:nth-child(3)');
                });
            }

            // 3. 绑定数据传输规范板块「全部展开/收起」按钮（联动单个面板）
            const allCollapseBtn2 = document.getElementById('allCollapseBtn2');
            if (allCollapseBtn2) {
                allCollapseBtn2.addEventListener('click', function() {
                    toggleAllCollapse(this, 'section:nth-child(4)');
                });
            }

            // 初始化：确保所有折叠图标初始状态为未旋转，无默认active类
            document.querySelectorAll('.collapse-header i.fa-chevron-down').forEach(icon => {
                icon.style.transform = 'rotate(0)';
            });
            document.querySelectorAll('.collapse-header').forEach(btn => {
                btn.classList.remove('active');
            });
        });
    </script>
</body>
</html>
